Link: https://gitlab.com/ubports/core/geonames/-/merge_requests/1#note_881195639
---
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 1ae9dfe..23407a5 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -1,11 +1,5 @@
-project(geonames)
-
 cmake_minimum_required(VERSION 3.0)
-
-set(TARGET geonames)
-set(VERSION_MAJOR 0)
-set(VERSION_MINOR 2)
-set(VERSION_PATCH 0)
+project(geonames VERSION 0.2.0 LANGUAGES C)
 
 include(GNUInstallDirs)
 include(FindPkgConfig)
diff --git a/demo/CMakeLists.txt b/demo/CMakeLists.txt
index e9c7f50..ea586f1 100644
--- a/demo/CMakeLists.txt
+++ b/demo/CMakeLists.txt
@@ -5,12 +5,12 @@ add_executable(geonames-demo
 )
 
 target_link_libraries(geonames-demo
-    ${TARGET}
+    ${PROJECT_NAME}
     ${GTK_LIBRARIES}
 )
 
 target_include_directories(geonames-demo PRIVATE
-    ${TARGET}
+    ${PROJECT_NAME}
     ../src
 
     ${GTK_INCLUDE_DIRS}
diff --git a/doc/reference/CMakeLists.txt b/doc/reference/CMakeLists.txt
index bddc9b3..01246c1 100644
--- a/doc/reference/CMakeLists.txt
+++ b/doc/reference/CMakeLists.txt
@@ -2,7 +2,7 @@ find_package(GtkDoc 1.25 REQUIRED)
 
 configure_file(geonames-docs.xml.in "${CMAKE_BINARY_DIR}/doc/geonames-docs.xml" @ONLY)
 
-gtk_doc_add_module(${TARGET}
+gtk_doc_add_module(${PROJECT_NAME}
     XML "${CMAKE_BINARY_DIR}/doc/geonames-docs.xml"
     SOURCE "${CMAKE_SOURCE_DIR}/src"
     SUFFIXES "h" "c"
@@ -15,5 +15,5 @@ gtk_doc_add_module(${TARGET}
 )
 
 add_custom_target(docs ALL)
-add_dependencies(docs doc-${TARGET})
-install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/html/ DESTINATION ${CMAKE_INSTALL_DATADIR}/gtk-doc/html/${TARGET})
+add_dependencies(docs doc-${PROJECT_NAME})
+install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/html/ DESTINATION ${CMAKE_INSTALL_DATADIR}/gtk-doc/html/${PROJECT_NAME})
diff --git a/doc/reference/geonames-docs.xml.in b/doc/reference/geonames-docs.xml.in
index 0d04b6b..1e98564 100644
--- a/doc/reference/geonames-docs.xml.in
+++ b/doc/reference/geonames-docs.xml.in
@@ -3,7 +3,7 @@
                       'http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd'
 [
   <!ENTITY % local.common.attrib "xmlns:xi  CDATA  #FIXED 'http://www.w3.org/2003/XInclude'">
-  <!ENTITY version "@VERSION_MAJOR@.@VERSION_MINOR@">
+  <!ENTITY version "@PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@">
 ]>
 
 <book id="geonames">
diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index a0ec12d..3db6ae1 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -48,25 +48,25 @@ add_custom_target(
     DEPENDS ${CMAKE_CURRENT_BINARY_DIR}/${GRESOURCE_C}
 )
 
-add_definitions(-DPACKAGE="${TARGET}")
+add_definitions(-DPACKAGE="${PROJECT_NAME}")
 
-add_library(${TARGET} SHARED
+add_library(${PROJECT_NAME} SHARED
     geonames.c
     geonames-query.c
 
     ${CMAKE_CURRENT_BINARY_DIR}/${GRESOURCE_C}
 )
 
-target_link_libraries(${TARGET}
+target_link_libraries(${PROJECT_NAME}
     -lglib-2.0
 )
 
-target_include_directories(${TARGET} PUBLIC
+target_include_directories(${PROJECT_NAME} PUBLIC
     ${GIO_INCLUDE_DIRS}
     ${GLIB_INCLUDE_DIRS}
 )
 
-target_link_libraries(${TARGET}
+target_link_libraries(${PROJECT_NAME}
     ${GIO_LIBRARIES}
     ${GLIB_LIBRARIES}
 )
@@ -75,7 +75,7 @@ add_custom_command(
     OUTPUT ${CMAKE_CURRENT_BINARY_DIR}/locales-gen
     WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
     COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/generate-locales.sh
-    ARGS ${TARGET} ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_BINARY_DIR}/locales-gen
+    ARGS ${PROJECT_NAME} ${CMAKE_CURRENT_BINARY_DIR} ${CMAKE_CURRENT_BINARY_DIR}/locales-gen
     VERBATIM
     MAIN_DEPENDENCY ${GENERATED_FILES}
 )
@@ -89,16 +89,13 @@ add_dependencies(geonames
     locales-gen
 )
 
-set_target_properties(
-    ${TARGET}
-
-    PROPERTIES
-    VERSION ${VERSION_MAJOR}.${VERSION_MINOR}.${VERSION_PATCH}
-    SOVERSION ${VERSION_MAJOR}
+set_target_properties(${PROJECT_NAME} PROPERTIES
+    VERSION ${PROJECT_VERSION}
+    SOVERSION ${PROJECT_VERSION_MAJOR}
 )
 
 install(DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}/locales-gen/locale/ DESTINATION ${CMAKE_INSTALL_LOCALEDIR}/)
-install(TARGETS ${TARGET} DESTINATION ${CMAKE_INSTALL_LIBDIR})
-install(FILES ${TARGET}.h DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/${TARGET})
-configure_file(${TARGET}.pc.in ${CMAKE_CURRENT_BINARY_DIR}/${TARGET}.pc @ONLY)
-install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${TARGET}.pc DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)
+install(TARGETS ${PROJECT_NAME} DESTINATION ${CMAKE_INSTALL_LIBDIR})
+install(FILES ${PROJECT_NAME}.h DESTINATION ${CMAKE_INSTALL_INCLUDEDIR}/${PROJECT_NAME})
+configure_file(${PROJECT_NAME}.pc.in ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}.pc @ONLY)
+install(FILES ${CMAKE_CURRENT_BINARY_DIR}/${PROJECT_NAME}.pc DESTINATION ${CMAKE_INSTALL_LIBDIR}/pkgconfig)
diff --git a/src/geonames.pc.in b/src/geonames.pc.in
index 39ea9db..654d8e4 100644
--- a/src/geonames.pc.in
+++ b/src/geonames.pc.in
@@ -5,7 +5,7 @@ includedir=@CMAKE_INSTALL_FULL_INCLUDEDIR@
 
 Name: Geonames
 Description: Parse and query the geonames database dump
-Version: @VERSION_MAJOR@.@VERSION_MINOR@.@VERSION_PATCH@
+Version: @PROJECT_VERSION_MAJOR@.@PROJECT_VERSION_MINOR@.@PROJECT_VERSION_PATCH@
 Requires: gio-unix-2.0
 Libs: -L${libdir} -lgeonames
 Cflags: -I${includedir}/geonames
diff --git a/tests/CMakeLists.txt b/tests/CMakeLists.txt
index 392da21..a9854aa 100644
--- a/tests/CMakeLists.txt
+++ b/tests/CMakeLists.txt
@@ -2,7 +2,7 @@ add_custom_command(
     OUTPUT locales
     WORKING_DIRECTORY ${CMAKE_CURRENT_BINARY_DIR}
     COMMAND ${CMAKE_CURRENT_SOURCE_DIR}/setup-test-env.sh
-    ARGS ${TARGET} ${GENERATED_PO_DIR}
+    ARGS ${PROJECT_NAME} ${GENERATED_PO_DIR}
     VERBATIM
     MAIN_DEPENDENCY ${GENERATED_FILES}
 )
@@ -13,7 +13,7 @@ add_custom_target(
 )
 
 add_definitions(
-    -DPACKAGE="${TARGET}"
+    -DPACKAGE="${PROJECT_NAME}"
     -DLOCALEDIR="${CMAKE_CURRENT_BINARY_DIR}/locales"
 )
 
@@ -26,11 +26,11 @@ add_dependencies(test_geonames
 )
 
 target_link_libraries(test_geonames
-    ${TARGET}
+    ${PROJECT_NAME}
 )
 
 target_include_directories(test_geonames PRIVATE
-    ${TARGET}
+    ${PROJECT_NAME}
     ../src
 )
 
