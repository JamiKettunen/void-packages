# Template file for 'click'
pkgname=click
version=0.5.0r1106
revision=1
_commit=dca9bd432e1bd04166fc8b97f7ad402aa6eafb69 # tip of main branch as of 2022-06-04
wrksrc="click-${_commit}"
build_style=gnu-configure
# --disable-packagekit
configure_args="--disable-systemd"
hostmakedepends="autoconf automake libtool pkg-config vala python3-setuptools"
makedepends="glib-devel gobject-introspection json-glib-devel libgee08-devel"
depends="python3"
short_desc="Manage Ubuntu Touch click packages (git ${_commit:0:7})"
maintainer="Jami Kettunen <jami.kettunen@protonmail.com>"
license="GPL-3.0-only"
homepage="https://gitlab.com/ubports/core/click"
distfiles="https://gitlab.com/ubports/core/click/-/archive/${_commit}.tar.gz"
checksum=787a8ed0ba6a9d9b7a21fa77509c02db72cd8f2db78ddc552513df14f0579f17

# FIXME: needs dpkg
make_check=no

build_helpers="gir qemu"
if [ "$CROSS_BUILD" ]; then
	hostmakedepends+=" gobject-introspection prelink-cross qemu-user-static"
fi

pre_configure() {
    autoreconf -fi
}

libclick_package() {
	#depends="${sourcepkg}>=${version}_${revision}"
	short_desc+=" - shared-libraries"
	pkg_install() {
		vmove "usr/lib/*.so.*"
	}
}

click-devel_package() {
	depends="${sourcepkg}>=${version}_${revision} lib${sourcepkg}>=${version}_${revision}
 json-glib-devel"
	short_desc+=" - development files"
	pkg_install() {
		vmove usr/include
		vmove usr/lib/pkgconfig
		vmove "usr/lib/*.so"
		vmove usr/share/gir-1.0
	}
}

# TODO: Remove debian/ubuntu cruft from DESTDIR
