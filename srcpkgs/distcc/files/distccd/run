#!/bin/sh
[ -r conf ] && . ./conf
: ${OPTS:=--log-level=warning}
: ${USER:=nobody}
ALLOW_FILE=/etc/distcc/clients.allow
if [ -f "$ALLOW_FILE" ]; then
        ALLOW_OPTS=$(sed -e 's/#.*$//' -e '/^\s*$/d' -e 's/^/--allow /' < $ALLOW_FILE)
fi
if [ -z "$ALLOW_OPTS" ]; then
        # Default to allow localhost
        ALLOW_OPTS="--allow 127.0.0.1"
fi
OPTS="$OPTS $ALLOW_OPTS"
exec distccd --daemon --no-detach --user $USER $OPTS
