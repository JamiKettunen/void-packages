# Template file for 'Aegisub'
pkgname=Aegisub
# FIXME: wait for new upstream release, v3.3.2 tag doesn't link against modern boost!
# /usr/bin/ld: CMakeFiles/Aegisub.dir/src/search_replace_engine.cpp.o: undefined reference to symbol '_ZN6icu_708Collator14createInstanceERKNS_6LocaleER10UErrorCode'
# /usr/bin/ld: /lib64/libicui18n.so.70: error adding symbols: DSO missing from command line
version=3.3.2r8112
revision=1
_commit=aa1e63f5bfed688711d8b46bf5dbd807d1c07300
wrksrc="Aegisub-${_commit}"
build_style=cmake
build_helper=cmake-wxWidgets-gtk3
cmake_builddir="BUILD"
configure_args="-DwxWidgets_CONFIG_EXECUTABLE=$WX_CONFIG
 -DWITH_PORTAUDIO=$(vopt_if portaudio ON OFF)
 -DWITH_OPENAL=$(vopt_if openal ON OFF) -DWITH_FFTW3=$(vopt_if fftw ON OFF)"
hostmakedepends="gettext-devel intltool pkg-config git LuaJIT"
makedepends="alsa-lib-devel boost-devel libcurl-devel fontconfig-devel
 freetype-devel hunspell-devel icu-devel libass-devel libffms2-devel
 MesaLib-devel wxWidgets-gtk3-devel LuaJIT-devel $(vopt_if fftw fftw-devel)
 $(vopt_if openal libopenal-devel) $(vopt_if portaudio portaudio-devel)"
short_desc="Subtitle editor (ssa, ass, srt)"
maintainer="pudiva <rogi@skylittlesystem.org>"
license="BSD-3-Clause, MIT"
homepage="https://github.com/wangqr/Aegisub"
distfiles="https://github.com/wangqr/Aegisub/archive/${_commit}.tar.gz"
checksum="a2073a57efa717e7e6ba8021727779e9695601e96127d5d5c4d0fb749174f2b9"

build_options="fftw openal portaudio"
build_options_default="fftw"

desc_option_fftw="Enable support for rendering of audio waveforms/spectrum"
desc_option_openal="Enable support for openal"

if [ "$XBPS_TARGET_NO_ATOMIC8" ]; then
	makedepends+=" libatomic-devel"
	configure_args+=" -DCMAKE_CXX_STANDARD_LIBRARIES=-latomic"
fi

pre_build() {
	export FORCE_GIT_VERSION="$version"
}

post_install() {
	vlicense LICENCE
}
